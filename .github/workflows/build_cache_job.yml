  # Build Caching & Performance Reporting
  build-cache:
    name: 🗄️ Cache Build Artifacts & Report
    runs-on: ubuntu-latest
    needs: [test-docker-deployment, performance-testing, documentation]
    if: success() && (github.event_name == 'push' || github.event_name == 'workflow_dispatch')
    
    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4
        
      - name: 🐳 Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
        
      - name: 🔑 Log in to GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 📥 Download Performance Results
        uses: actions/download-artifact@v3
        with:
          name: performance-results
          path: performance-results
          
      - name: 📊 Generate Performance Report
        run: |
          # Create a markdown report with the results
          echo "# Performance Test Results" > performance-report.md
          echo "" >> performance-report.md
          echo "## Summary" >> performance-report.md
          echo "This report shows the results of performance tests from the latest build." >> performance-report.md
          echo "" >> performance-report.md
          echo "## Component Benchmarks" >> performance-report.md
          echo "![Benchmark Results](./performance-results/benchmark-visualization.png)" >> performance-report.md
          echo "" >> performance-report.md
          echo "## Load Test Results" >> performance-report.md
          echo "Load tests were performed with 10 concurrent users for 1 minute." >> performance-report.md
          echo "Detailed report: [Locust HTML Report](./performance-results/locust-report.html)" >> performance-report.md
          
      - name: 🏗️ Build and Cache Docker Images
        id: build
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./Dockerfile.backend
          push: true
          tags: ghcr.io/${{ github.repository }}/backend:${{ github.sha }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
          
      - name: 📤 Upload Performance Report
        uses: actions/upload-artifact@v3
        with:
          name: performance-report
          path: performance-report.md
          retention-days: 14
          
      - name: 📌 Create Performance Comment
        if: github.event_name == 'pull_request'
        uses: peter-evans/create-or-update-comment@v3
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## 📊 Performance Test Results
            
            The latest build has completed performance testing. Key metrics:
            
            - **Build Time**: ${{ steps.build.outputs.duration }}
            - **Image Size**: ${{ steps.build.outputs.size }} MB
            - **Cache Hit Ratio**: ${{ steps.build.outputs.cache-hit-ratio }}%
            
            [View detailed performance report](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/actions/runs/${GITHUB_RUN_ID})