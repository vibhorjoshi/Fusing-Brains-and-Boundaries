<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ∞Ô∏è Real USA Agricultural Detection - Live Performance Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a2332 50%, #2d3748 100%);
            color: white;
            overflow-x: hidden;
        }

        .main-header {
            background: linear-gradient(90deg, #00C851 0%, #007E33 50%, #004d20 100%);
            padding: 20px 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 200, 81, 0.3);
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .main-header h1 {
            font-size: 3.2em;
            font-weight: bold;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            position: relative;
            z-index: 2;
            margin-bottom: 10px;
        }

        .main-header p {
            font-size: 1.3em;
            opacity: 0.95;
            position: relative;
            z-index: 2;
        }

        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 30px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 25px;
            height: calc(100vh - 200px);
        }

        .control-panel {
            grid-column: 1 / -1;
            background: rgba(45, 55, 72, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(0, 200, 81, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .control-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-size: 0.9em;
            color: #a0aec0;
            font-weight: 600;
        }

        select, input {
            padding: 12px 15px;
            border: 2px solid rgba(0, 200, 81, 0.3);
            border-radius: 8px;
            background: rgba(26, 35, 50, 0.8);
            color: white;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #00C851;
            box-shadow: 0 0 0 3px rgba(0, 200, 81, 0.2);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00C851, #007E33);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #007E33, #004d20);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 200, 81, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #FF6B35, #E55100);
            color: white;
        }

        .map-container {
            background: rgba(26, 35, 50, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(0, 200, 81, 0.3);
            position: relative;
            overflow: hidden;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .map-header h3 {
            font-size: 1.4em;
            color: #00C851;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #00C851;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        #usa-map {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            border: 1px solid rgba(0, 200, 81, 0.2);
        }

        .metrics-container {
            background: rgba(26, 35, 50, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(0, 200, 81, 0.3);
            display: flex;
            flex-direction: column;
        }

        .metrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metrics-header h3 {
            font-size: 1.4em;
            color: #00C851;
        }

        .metric-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: rgba(0, 200, 81, 0.1);
            border: 1px solid rgba(0, 200, 81, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00C851;
        }

        .metric-label {
            font-size: 0.9em;
            color: #a0aec0;
            margin-top: 5px;
        }

        #performance-chart {
            flex: 1;
            min-height: 250px;
        }

        .status-bar {
            grid-column: 1 / -1;
            background: rgba(26, 35, 50, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(0, 200, 81, 0.3);
        }

        .status-items {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .status-connected { background: #00C851; }
        .status-processing { background: #FFC107; }
        .status-error { background: #F44336; }

        .region-popup {
            background: rgba(26, 35, 50, 0.95);
            color: white;
            border: 2px solid #00C851;
            border-radius: 10px;
            padding: 15px;
            min-width: 250px;
        }

        .region-popup h4 {
            color: #00C851;
            margin-bottom: 10px;
        }

        .region-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.9em;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 200, 81, 0.3);
            border-top: 4px solid #00C851;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .redis-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <div class="main-header">
        <h1>üõ∞Ô∏è Real USA Agricultural Detection System</h1>
        <p>Live Satellite Monitoring ‚Ä¢ Real Performance Metrics ‚Ä¢ Redis Storage</p>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-row">
                <div class="control-group">
                    <label for="satellite-provider">Satellite Provider</label>
                    <select id="satellite-provider">
                        <option value="nasa">NASA Landsat-9</option>
                        <option value="google">Google Earth Engine</option>
                        <option value="sentinel">Sentinel-2</option>
                        <option value="modis">MODIS Terra</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="region-select">Agricultural Region</label>
                    <select id="region-select">
                        <option value="">Select Region...</option>
                        <option value="california">California Central Valley</option>
                        <option value="iowa">Iowa Corn Belt</option>
                        <option value="kansas">Kansas Wheat Belt</option>
                        <option value="texas">Texas Panhandle & Rio Grande</option>
                        <option value="nebraska">Nebraska Corn & Beef</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="update-frequency">Update Frequency (seconds)</label>
                    <input type="number" id="update-frequency" value="5" min="3" max="30">
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" id="start-detection">
                        üöÄ Start Live Detection
                    </button>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-secondary" id="stop-detection">
                        ‚èπÔ∏è Stop Detection
                    </button>
                </div>
            </div>
        </div>

        <!-- USA Map Container -->
        <div class="map-container">
            <div class="map-header">
                <h3>üó∫Ô∏è USA Agricultural Regions Map</h3>
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    <span id="map-status">Ready for Detection</span>
                </div>
            </div>
            <div id="usa-map"></div>
            <div id="map-loading" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <div>Loading Real Agricultural Data...</div>
            </div>
        </div>

        <!-- Performance Metrics Container -->
        <div class="metrics-container">
            <div class="metrics-header">
                <h3>üìä Live Performance Metrics</h3>
                <div class="redis-status">
                    <div class="status-icon" id="redis-indicator"></div>
                    <span id="redis-status">Connecting to Redis...</span>
                </div>
            </div>

            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-value" id="accuracy-metric">--</div>
                    <div class="metric-label">Overall Accuracy</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="detections-metric">--</div>
                    <div class="metric-label">Total Detections</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="processing-time-metric">--</div>
                    <div class="metric-label">Avg Processing Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="images-processed-metric">--</div>
                    <div class="metric-label">Images Processed</div>
                </div>
            </div>

            <div id="performance-chart"></div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-items">
                <div class="status-item">
                    <div class="status-icon" id="api-status"></div>
                    <span id="api-status-text">Checking API...</span>
                </div>
                <div class="status-item">
                    <div class="status-icon" id="websocket-status"></div>
                    <span id="websocket-status-text">Connecting WebSocket...</span>
                </div>
                <div class="status-item">
                    <span id="session-info">No Active Session</span>
                </div>
                <div class="status-item">
                    <span id="last-update">Never Updated</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:8006';
        const API_KEY = 'satellite-agriculture-live-2024';
        
        // Global variables
        let map = null;
        let websocket = null;
        let currentSession = null;
        let detectionMarkers = [];
        let performanceData = [];
        let regionLayers = {};
        
        // Real USA Agricultural Regions Data (matches backend)
        const USA_REGIONS = {
            california: {
                name: "California Central Valley",
                coordinates: [36.7783, -119.4179],
                bounds: [[35.6, -121.0], [37.9, -118.0]],
                color: "#FF6B35"
            },
            iowa: {
                name: "Iowa Corn Belt", 
                coordinates: [42.0308, -93.6319],
                bounds: [[40.4, -96.6], [43.5, -90.1]],
                color: "#4ECDC4"
            },
            kansas: {
                name: "Kansas Wheat Belt",
                coordinates: [38.5267, -96.7265],
                bounds: [[37.0, -102.1], [40.0, -94.6]],
                color: "#45B7D1"
            },
            texas: {
                name: "Texas Panhandle & Rio Grande Valley",
                coordinates: [31.9686, -99.9018],
                bounds: [[25.8, -106.6], [36.5, -93.5]],
                color: "#96CEB4"
            },
            nebraska: {
                name: "Nebraska Corn & Beef",
                coordinates: [41.1254, -98.2681], 
                bounds: [[40.0, -104.1], [43.0, -95.3]],
                color: "#FFEAA7"
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            checkAPIStatus();
            checkRedisStatus();
            connectWebSocket();
            initializeEventListeners();
            loadRegionalData();
        });

        // Initialize Leaflet map
        function initializeMap() {
            map = L.map('usa-map').setView([39.8283, -98.5795], 4);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors | Real Agricultural Data'
            }).addTo(map);

            // Add USA agricultural regions
            Object.entries(USA_REGIONS).forEach(([key, region]) => {
                const bounds = L.latLngBounds(region.bounds);
                const rectangle = L.rectangle(bounds, {
                    color: region.color,
                    fillColor: region.color,
                    fillOpacity: 0.3,
                    weight: 2
                }).addTo(map);

                // Add region marker
                const marker = L.marker(region.coordinates)
                    .bindPopup(`
                        <div class="region-popup">
                            <h4>${region.name}</h4>
                            <div class="region-stats">
                                <span>Status:</span><span>Ready</span>
                                <span>Provider:</span><span id="popup-provider-${key}">Not Selected</span>
                                <span>Last Detection:</span><span id="popup-update-${key}">Never</span>
                                <span>Accuracy:</span><span id="popup-accuracy-${key}">--</span>
                            </div>
                        </div>
                    `)
                    .addTo(map);

                regionLayers[key] = { rectangle, marker };

                // Click handler for region selection
                rectangle.on('click', () => selectRegion(key));
                marker.on('click', () => selectRegion(key));
            });
        }

        // Select region handler
        function selectRegion(regionKey) {
            document.getElementById('region-select').value = regionKey;
            const region = USA_REGIONS[regionKey];
            map.flyToBounds(L.latLngBounds(region.bounds), { duration: 1 });
        }

        // Check API status
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                const data = await response.json();
                
                document.getElementById('api-status').className = 'status-icon status-connected';
                document.getElementById('api-status-text').textContent = `API Connected - ${data.version}`;
                
                if (data.redis_status === 'connected') {
                    document.getElementById('redis-indicator').className = 'status-icon status-connected';
                    document.getElementById('redis-status').textContent = 'Redis Connected';
                } else {
                    document.getElementById('redis-indicator').className = 'status-icon status-error';
                    document.getElementById('redis-status').textContent = 'Redis Disconnected';
                }
                
            } catch (error) {
                document.getElementById('api-status').className = 'status-icon status-error';
                document.getElementById('api-status-text').textContent = 'API Connection Failed';
                console.error('API Status Error:', error);
            }
        }

        // Check Redis status
        async function checkRedisStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/redis/stats`);
                const data = await response.json();
                
                if (data.redis_status === 'connected') {
                    document.getElementById('redis-indicator').className = 'status-icon status-connected';
                    document.getElementById('redis-status').textContent = `Redis: ${data.stored_data.total_keys} records`;
                }
            } catch (error) {
                console.error('Redis Status Error:', error);
            }
        }

        // Connect WebSocket
        function connectWebSocket() {
            try {
                websocket = new WebSocket(`ws://localhost:8006/ws/real-live-feed`);
                
                websocket.onopen = function() {
                    document.getElementById('websocket-status').className = 'status-icon status-connected';
                    document.getElementById('websocket-status-text').textContent = 'WebSocket Connected';
                };

                websocket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleRealtimeUpdate(data);
                };

                websocket.onclose = function() {
                    document.getElementById('websocket-status').className = 'status-icon status-error';
                    document.getElementById('websocket-status-text').textContent = 'WebSocket Disconnected';
                    
                    // Reconnect after 5 seconds
                    setTimeout(connectWebSocket, 5000);
                };

                websocket.onerror = function(error) {
                    document.getElementById('websocket-status').className = 'status-icon status-error';
                    document.getElementById('websocket-status-text').textContent = 'WebSocket Error';
                };
                
            } catch (error) {
                console.error('WebSocket Error:', error);
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            document.getElementById('start-detection').addEventListener('click', startLiveDetection);
            document.getElementById('stop-detection').addEventListener('click', stopLiveDetection);
        }

        // Load regional data
        async function loadRegionalData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/usa/real-agricultural-regions`);
                const data = await response.json();
                
                // Update map markers with real data
                Object.entries(data.regions).forEach(([key, regionData]) => {
                    if (regionLayers[key]) {
                        const popupContent = `
                            <div class="region-popup">
                                <h4>${regionData.name}</h4>
                                <div class="region-stats">
                                    <span>Area:</span><span>${regionData.agricultural_area_km2.toLocaleString()} km¬≤</span>
                                    <span>Farms:</span><span>${regionData.farms_count.toLocaleString()}</span>
                                    <span>Production:</span><span>${(regionData.annual_production_tons / 1000000).toFixed(1)}M tons</span>
                                    <span>Major Crops:</span><span>${regionData.major_crops.slice(0, 3).join(', ')}</span>
                                </div>
                            </div>
                        `;
                        regionLayers[key].marker.setPopupContent(popupContent);
                    }
                });
                
            } catch (error) {
                console.error('Regional Data Error:', error);
            }
        }

        // Start live detection
        async function startLiveDetection() {
            const provider = document.getElementById('satellite-provider').value;
            const region = document.getElementById('region-select').value;
            const frequency = parseInt(document.getElementById('update-frequency').value);

            if (!region) {
                alert('Please select an agricultural region first!');
                return;
            }

            try {
                document.getElementById('map-loading').style.display = 'flex';
                document.getElementById('map-status').textContent = 'Starting Detection...';

                const response = await fetch(`${API_BASE_URL}/api/live/start-real-detection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY
                    },
                    body: JSON.stringify({
                        satellite_provider: provider,
                        region: region,
                        detection_types: ['crops', 'buildings'],
                        adaptive_fusion: true,
                        real_time_training: true,
                        update_frequency: frequency
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    currentSession = result.session_id;
                    document.getElementById('session-info').textContent = `Session: ${currentSession}`;
                    document.getElementById('map-status').textContent = 'Live Detection Active';
                    
                    // Start monitoring session
                    startSessionMonitoring();
                } else {
                    throw new Error(result.message || 'Failed to start detection');
                }

            } catch (error) {
                alert(`Failed to start detection: ${error.message}`);
                console.error('Detection Start Error:', error);
            } finally {
                document.getElementById('map-loading').style.display = 'none';
            }
        }

        // Stop live detection
        function stopLiveDetection() {
            if (currentSession) {
                currentSession = null;
                document.getElementById('session-info').textContent = 'No Active Session';
                document.getElementById('map-status').textContent = 'Detection Stopped';
                
                // Clear markers
                detectionMarkers.forEach(marker => map.removeLayer(marker));
                detectionMarkers = [];
            }
        }

        // Start session monitoring
        function startSessionMonitoring() {
            const monitorSession = async () => {
                if (!currentSession) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/live/real-session/${currentSession}`);
                    const data = await response.json();
                    
                    updateMetrics(data);
                    
                } catch (error) {
                    console.error('Session Monitoring Error:', error);
                }
                
                // Continue monitoring if session is active
                if (currentSession) {
                    setTimeout(monitorSession, 3000);
                }
            };
            
            monitorSession();
        }

        // Handle real-time WebSocket updates
        function handleRealtimeUpdate(data) {
            if (data.result) {
                const result = data.result;
                
                // Add detection marker to map
                addDetectionMarker(result);
                
                // Update performance chart
                updatePerformanceChart(result);
                
                // Update last update time
                document.getElementById('last-update').textContent = 
                    `Updated: ${new Date(result.timestamp).toLocaleTimeString()}`;
            }
        }

        // Add detection marker to map
        function addDetectionMarker(result) {
            const coords = result.coordinates;
            const marker = L.circleMarker([coords.lat, coords.lng], {
                color: result.overall_accuracy > 0.8 ? '#00C851' : result.overall_accuracy > 0.6 ? '#FFC107' : '#F44336',
                fillColor: result.overall_accuracy > 0.8 ? '#00C851' : result.overall_accuracy > 0.6 ? '#FFC107' : '#F44336',
                fillOpacity: 0.7,
                radius: Math.max(5, result.crop_detections / 10)
            }).addTo(map);
            
            marker.bindPopup(`
                <div class="region-popup">
                    <h4>Detection Result</h4>
                    <div class="region-stats">
                        <span>Accuracy:</span><span>${(result.overall_accuracy * 100).toFixed(1)}%</span>
                        <span>Crops:</span><span>${result.crop_detections}</span>
                        <span>Buildings:</span><span>${result.building_detections}</span>
                        <span>Provider:</span><span>${result.satellite_provider.toUpperCase()}</span>
                        <span>Time:</span><span>${result.processing_time_ms}ms</span>
                    </div>
                </div>
            `);
            
            detectionMarkers.push(marker);
            
            // Keep only last 50 markers
            if (detectionMarkers.length > 50) {
                const oldMarker = detectionMarkers.shift();
                map.removeLayer(oldMarker);
            }
        }

        // Update metrics display
        function updateMetrics(sessionData) {
            const session = sessionData.session;
            
            document.getElementById('accuracy-metric').textContent = 
                `${(session.current_accuracy * 100).toFixed(1)}%`;
            document.getElementById('detections-metric').textContent = 
                session.detections_count.toLocaleString();
            document.getElementById('processing-time-metric').textContent = 
                `${sessionData.recent_results.length > 0 ? 
                    sessionData.recent_results[sessionData.recent_results.length - 1].processing_time_ms : '--'}ms`;
            document.getElementById('images-processed-metric').textContent = 
                session.images_processed.toLocaleString();
        }

        // Update performance chart
        function updatePerformanceChart(result) {
            performanceData.push({
                timestamp: new Date(result.timestamp),
                accuracy: result.overall_accuracy * 100,
                crop_accuracy: result.crop_accuracy * 100,
                building_accuracy: result.building_accuracy * 100,
                processing_time: result.processing_time_ms
            });
            
            // Keep only last 50 data points
            if (performanceData.length > 50) {
                performanceData = performanceData.slice(-50);
            }
            
            const trace1 = {
                x: performanceData.map(d => d.timestamp),
                y: performanceData.map(d => d.accuracy),
                name: 'Overall Accuracy',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#00C851' }
            };
            
            const trace2 = {
                x: performanceData.map(d => d.timestamp),
                y: performanceData.map(d => d.crop_accuracy),
                name: 'Crop Accuracy',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#4ECDC4' }
            };
            
            const trace3 = {
                x: performanceData.map(d => d.timestamp),
                y: performanceData.map(d => d.building_accuracy),
                name: 'Building Accuracy',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#FF6B35' }
            };
            
            const layout = {
                title: 'Real-Time Performance Metrics',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' },
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                yaxis: { 
                    title: 'Accuracy (%)',
                    range: [0, 100],
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                margin: { t: 40, r: 10, b: 40, l: 50 }
            };
            
            Plotly.newPlot('performance-chart', [trace1, trace2, trace3], layout, {
                responsive: true,
                displayModeBar: false
            });
        }

        // Periodic status updates
        setInterval(() => {
            checkAPIStatus();
            checkRedisStatus();
        }, 30000); // Every 30 seconds
    </script>
</body>
</html>