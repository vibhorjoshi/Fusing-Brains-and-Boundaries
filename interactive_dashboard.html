<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoAI Live Dashboard - Building Footprint Detection Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization"></script>
    <style>
        :root {
            --primary-blue: #0078d4;
            --secondary-blue: #106ebe;
            --success-green: #107c10;
            --warning-orange: #ff8c00;
            --danger-red: #d13438;
            --dark-bg: #1e1e1e;
            --card-bg: #252526;
            --border-color: #404040;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --accent-cyan: #00bcf2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1800px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .status-indicators {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online { background: var(--success-green); }
        .status-dot.processing { background: var(--warning-orange); }
        .status-dot.offline { background: var(--danger-red); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Main Dashboard */
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 8px 25px rgba(0, 120, 212, 0.2);
            transform: translateY(-2px);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-cyan));
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-icon {
            font-size: 2rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .metric-change {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .metric-change.positive {
            background: rgba(16, 124, 16, 0.2);
            color: var(--success-green);
        }

        .metric-change.negative {
            background: rgba(209, 52, 56, 0.2);
            color: var(--danger-red);
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-blue);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        /* Map Section */
        .map-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .map-container {
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        /* Pipeline Visualization */
        .pipeline-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .pipeline-steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }

        .pipeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .step-circle.active {
            background: var(--primary-blue);
            box-shadow: 0 0 20px rgba(0, 120, 212, 0.5);
            animation: pulse-step 2s infinite;
        }

        .step-circle.completed {
            background: var(--success-green);
        }

        @keyframes pulse-step {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .step-connector {
            position: absolute;
            top: 30px;
            left: 60px;
            right: -60px;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }

        .step-connector.active {
            background: var(--primary-blue);
            animation: flow 2s infinite;
        }

        @keyframes flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .step-label {
            font-size: 0.8rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* API Testing Panel */
        .api-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
        }

        .api-endpoint {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 120, 212, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .api-endpoint:hover {
            background: rgba(0, 120, 212, 0.2);
        }

        .api-method {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .api-method.get { background: var(--success-green); }
        .api-method.post { background: var(--primary-blue); }

        .api-url {
            font-family: 'Consolas', monospace;
            flex: 1;
        }

        .api-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .api-status.success { background: var(--success-green); }
        .api-status.error { background: var(--danger-red); }
        .api-status.pending { background: var(--warning-orange); }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .map-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .status-indicators {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .pipeline-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .step-connector {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div style="font-size: 2rem;">üåç</div>
                <h1>GeoAI Live Dashboard</h1>
            </div>
            <div class="status-indicators">
                <div class="status-item">
                    <div class="status-dot" id="api-status"></div>
                    <span>API Server</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="ml-status"></div>
                    <span>ML Pipeline</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="data-status"></div>
                    <span>Data Stream</span>
                </div>
                <div class="status-item">
                    <span id="last-update">Last Update: --:--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard">
        <!-- Key Metrics -->
        <div class="metrics-row">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon">üèóÔ∏è</div>
                    <div class="metric-change positive" id="buildings-change">+5.2%</div>
                </div>
                <div class="metric-value" id="total-buildings">0</div>
                <div class="metric-label">Total Buildings Detected</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon">üìä</div>
                    <div class="metric-change positive" id="accuracy-change">+2.1%</div>
                </div>
                <div class="metric-value" id="accuracy">0%</div>
                <div class="metric-label">Detection Accuracy</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon">‚è±Ô∏è</div>
                    <div class="metric-change positive" id="speed-change">-12%</div>
                </div>
                <div class="metric-value" id="avg-time">0s</div>
                <div class="metric-label">Avg Processing Time</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon">üéØ</div>
                    <div class="metric-change positive" id="iou-change">+3.4%</div>
                </div>
                <div class="metric-value" id="iou-score">0%</div>
                <div class="metric-label">IoU Score</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">Performance Trends</div>
                    <div class="chart-controls">
                        <button class="btn btn-secondary" onclick="changeTimeframe('1h')">1H</button>
                        <button class="btn btn-secondary" onclick="changeTimeframe('24h')">24H</button>
                        <button class="btn btn-primary" onclick="changeTimeframe('7d')">7D</button>
                    </div>
                </div>
                <canvas id="performance-chart" height="300"></canvas>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">State Performance</div>
                </div>
                <canvas id="state-chart" height="300"></canvas>
            </div>
        </div>

        <!-- Maps and Pipeline -->
        <div class="map-section">
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">Alabama Cities Performance</div>
                    <button class="btn btn-primary" onclick="refreshMap()">Refresh</button>
                </div>
                <div id="alabama-map" class="map-container"></div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">Processing Pipeline Status</div>
                    <button class="btn btn-primary" onclick="startPipeline()">Start Process</button>
                </div>
                <div id="pipeline-images" style="height: 300px; overflow-y: auto;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="text-align: center;">
                            <div style="margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">Original</div>
                            <div id="original-image" style="width: 100%; height: 120px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                üì∑
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">Processed</div>
                            <div id="processed-image" style="width: 100%; height: 120px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <div class="loading" style="display: none;"></div>
                                <span id="processed-placeholder">üîÑ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Pipeline Visualization -->
        <div class="pipeline-section">
            <div class="chart-header">
                <div class="chart-title">Live Processing Pipeline</div>
                <div class="chart-controls">
                    <span id="current-step">Ready</span>
                    <button class="btn btn-primary" onclick="startPipeline()">Start Process</button>
                </div>
            </div>
            
            <div class="pipeline-steps">
                <div class="pipeline-step">
                    <div class="step-circle" data-step="0">üîç</div>
                    <div class="step-label">Detection</div>
                    <div class="step-connector"></div>
                </div>
                <div class="pipeline-step">
                    <div class="step-circle" data-step="1">üìê</div>
                    <div class="step-label">RT Regularization</div>
                    <div class="step-connector"></div>
                </div>
                <div class="pipeline-step">
                    <div class="step-circle" data-step="2">üìè</div>
                    <div class="step-label">RR Regularization</div>
                    <div class="step-connector"></div>
                </div>
                <div class="pipeline-step">
                    <div class="step-circle" data-step="3">‚ú®</div>
                    <div class="step-label">FER Processing</div>
                    <div class="step-connector"></div>
                </div>
                <div class="pipeline-step">
                    <div class="step-circle" data-step="4">ü§ñ</div>
                    <div class="step-label">RL Fusion</div>
                    <div class="step-connector"></div>
                </div>
                <div class="pipeline-step">
                    <div class="step-circle" data-step="5">‚úÖ</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
        </div>

        <!-- API Testing Panel -->
        <div class="api-panel">
            <div class="chart-header">
                <div class="chart-title">API Endpoint Testing</div>
                <button class="btn btn-primary" onclick="testAllEndpoints()">Test All</button>
            </div>
            
            <div id="api-endpoints">
                <div class="api-endpoint" onclick="testEndpoint('/health')">
                    <div class="api-method get">GET</div>
                    <div class="api-url">/health</div>
                    <div class="api-status" id="status-health"></div>
                </div>
                
                <div class="api-endpoint" onclick="testEndpoint('/api/v1/training/status')">
                    <div class="api-method get">GET</div>
                    <div class="api-url">/api/v1/training/status</div>
                    <div class="api-status" id="status-training"></div>
                </div>
                
                <div class="api-endpoint" onclick="testEndpoint('/api/v1/analytics/overview')">
                    <div class="api-method get">GET</div>
                    <div class="api-url">/api/v1/analytics/overview</div>
                    <div class="api-status" id="status-analytics"></div>
                </div>
                
                <div class="api-endpoint" onclick="testEndpoint('/api/v1/analytics/alabama_performance')">
                    <div class="api-method get">GET</div>
                    <div class="api-url">/api/v1/analytics/alabama_performance</div>
                    <div class="api-status" id="status-alabama"></div>
                </div>
                
                <div class="api-endpoint" onclick="testEndpoint('/api/v1/building/detect')">
                    <div class="api-method get">GET</div>
                    <div class="api-url">/api/v1/building/detect</div>
                    <div class="api-status" id="status-building"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:8002';
        let charts = {};
        let updateInterval;
        let currentStep = 0;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            startLiveUpdates();
            testAllEndpoints();
        });

        // Live Updates
        function startLiveUpdates() {
            updateDashboard();
            updateInterval = setInterval(updateDashboard, 5000); // Update every 5 seconds
        }

        async function updateDashboard() {
            try {
                // Update key metrics
                await updateMetrics();
                
                // Update charts
                await updateCharts();
                
                // Update status indicators
                updateStatusIndicators();
                
                // Update timestamp
                document.getElementById('last-update').textContent = 
                    `Last Update: ${new Date().toLocaleTimeString()}`;
                    
            } catch (error) {
                console.error('Dashboard update failed:', error);
                setStatus('data-status', 'error');
            }
        }

        async function updateMetrics() {
            try {
                const [analytics, training] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/v1/analytics/overview`).then(r => r.json()),
                    fetch(`${API_BASE_URL}/api/v1/training/status`).then(r => r.json())
                ]);

                // Update metric values with animations
                animateValue('total-buildings', analytics.total_buildings_detected || 0);
                animateValue('accuracy', Math.round((training.accuracy || 0) * 100), '%');
                animateValue('avg-time', analytics.avg_processing_time || 0, 's');
                animateValue('iou-score', Math.round((training.iou_score || 0) * 100), '%');

                setStatus('data-status', 'online');
            } catch (error) {
                console.error('Failed to update metrics:', error);
                setStatus('data-status', 'error');
            }
        }

        function animateValue(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            const currentValue = parseInt(element.textContent) || 0;
            const increment = (targetValue - currentValue) / 30;
            
            let current = currentValue;
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= targetValue) || (increment < 0 && current <= targetValue)) {
                    current = targetValue;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current) + suffix;
            }, 50);
        }

        function setStatus(elementId, status) {
            const element = document.getElementById(elementId);
            element.className = `status-dot ${status}`;
        }

        function updateStatusIndicators() {
            // Simulate status checks
            setStatus('api-status', 'online');
            setStatus('ml-status', Math.random() > 0.8 ? 'processing' : 'online');
        }

        // Charts
        function initializeCharts() {
            // Performance Trends Chart
            const perfCtx = document.getElementById('performance-chart').getContext('2d');
            charts.performance = new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: generateTimeLabels(24),
                    datasets: [
                        {
                            label: 'IoU Score',
                            data: generateRandomData(24, 0.6, 0.8),
                            borderColor: '#0078d4',
                            backgroundColor: 'rgba(0, 120, 212, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Accuracy',
                            data: generateRandomData(24, 0.7, 0.9),
                            borderColor: '#00bcf2',
                            backgroundColor: 'rgba(0, 188, 242, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#cccccc' },
                            grid: { color: '#404040' }
                        },
                        y: {
                            ticks: { color: '#cccccc' },
                            grid: { color: '#404040' },
                            min: 0,
                            max: 1
                        }
                    }
                }
            });

            // State Performance Chart
            const stateCtx = document.getElementById('state-chart').getContext('2d');
            charts.states = new Chart(stateCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Alabama', 'Georgia', 'Florida', 'Tennessee', 'Mississippi'],
                    datasets: [{
                        data: [156421, 189234, 234567, 98234, 87654],
                        backgroundColor: [
                            '#0078d4',
                            '#00bcf2',
                            '#107c10',
                            '#ff8c00',
                            '#d13438'
                        ],
                        borderColor: '#252526',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffffff' }
                        }
                    }
                }
            });
        }

        async function updateCharts() {
            // Update performance chart with new data
            const newData = generateRandomData(24, 0.6, 0.8);
            charts.performance.data.datasets[0].data = newData;
            charts.performance.update('none');
        }

        function generateTimeLabels(hours) {
            const labels = [];
            const now = new Date();
            for (let i = hours; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
            }
            return labels;
        }

        function generateRandomData(count, min, max) {
            return Array.from({ length: count }, () => Math.random() * (max - min) + min);
        }

        // API Testing
        async function testEndpoint(endpoint) {
            const statusId = `status-${endpoint.split('/').pop().replace('_', '-')}`;
            const statusElement = document.getElementById(statusId);
            
            if (statusElement) {
                statusElement.className = 'api-status pending';
                
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`);
                    statusElement.className = response.ok ? 'api-status success' : 'api-status error';
                    
                    if (endpoint === '/health' && response.ok) {
                        setStatus('api-status', 'online');
                    }
                } catch (error) {
                    statusElement.className = 'api-status error';
                    console.error(`Failed to test ${endpoint}:`, error);
                }
            }
        }

        async function testAllEndpoints() {
            const endpoints = [
                '/health',
                '/api/v1/training/status', 
                '/api/v1/analytics/overview',
                '/api/v1/analytics/alabama_performance',
                '/api/v1/building/detect'
            ];
            
            for (const endpoint of endpoints) {
                await testEndpoint(endpoint);
                await new Promise(resolve => setTimeout(resolve, 200)); // Small delay between requests
            }
        }

        // Pipeline Animation
        function startPipeline() {
            currentStep = 0;
            document.getElementById('current-step').textContent = 'Processing...';
            
            // Reset all steps
            document.querySelectorAll('.step-circle').forEach(circle => {
                circle.className = 'step-circle';
            });
            
            // Animate through steps
            animateStep(0);
        }

        function animateStep(step) {
            const steps = document.querySelectorAll('.step-circle');
            const stepNames = ['Detection', 'RT Regularization', 'RR Regularization', 'FER Processing', 'RL Fusion', 'Complete'];
            
            if (step < steps.length) {
                // Mark current step as active
                steps[step].className = 'step-circle active';
                document.getElementById('current-step').textContent = `Processing: ${stepNames[step]}`;
                
                // Mark previous step as completed
                if (step > 0) {
                    steps[step - 1].className = 'step-circle completed';
                }
                
                // Continue to next step
                setTimeout(() => animateStep(step + 1), 2000);
            } else {
                // Pipeline complete
                steps[steps.length - 1].className = 'step-circle completed';
                document.getElementById('current-step').textContent = 'Complete!';
                
                // Show processed image
                setTimeout(() => {
                    document.getElementById('processed-placeholder').textContent = '‚úÖ';
                    document.getElementById('current-step').textContent = 'Ready';
                }, 1000);
            }
        }

        // Utility Functions
        function changeTimeframe(timeframe) {
            // Update chart timeframe
            console.log(`Changing timeframe to: ${timeframe}`);
            
            // Update button states
            document.querySelectorAll('.chart-controls .btn').forEach(btn => {
                btn.className = 'btn btn-secondary';
            });
            event.target.className = 'btn btn-primary';
        }

        function refreshMap() {
            console.log('Refreshing Alabama map...');
            // Implement map refresh logic
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Dashboard error:', e.error);
            setStatus('data-status', 'error');
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>